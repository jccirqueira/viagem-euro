<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euro2026 | Premium Travel Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --accent: #2563eb;
            --accent-dark: #1e40af;
            --bg-main: #020617;
            --bg-card: rgba(15, 23, 42, 0.7);
            --bg-input: #0f172a;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border-glass: rgba(255, 255, 255, 0.05);
            --shadow-card: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
        }

        .light-mode {
            --bg-main: #f1f5f9;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-input: #ffffff;
            --text-main: #0f172a;
            --text-muted: #475569;
            --border-glass: rgba(0, 0, 0, 0.1);
            --shadow-card: 0 4px 20px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        .bg-slate-950 {
            background-color: var(--bg-main) !important;
        }

        .bg-slate-900 {
            background-color: var(--bg-input) !important;
        }

        .glass {
            background: var(--bg-card) !important;
            backdrop-filter: blur(16px);
            border: 1px solid var(--border-glass) !important;
            box-shadow: var(--shadow-card);
        }

        .text-slate-500 {
            color: var(--text-muted) !important;
        }

        .text-slate-400 {
            color: var(--text-muted) !important;
        }

        .light-mode .text-white:not(.btn-primary *, .nav-link.active *, .bg-accent *, .bg-gradient-to-br *, .bg-red-500 *) {
            color: var(--text-main) !important;
        }

        .light-mode .border-slate-800,
        .light-mode .border-slate-900 {
            border-color: var(--border-glass) !important;
        }

        .light-mode input,
        .light-mode select,
        .light-mode textarea {
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
            color: #0f172a !important;
        }

        .light-mode .bg-slate-800\/10.text-slate-500 {
            background-color: #ffffff !important;
            border: 1px solid rgba(0, 0, 0, 0.15) !important;
            color: var(--accent) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
        }

        .theme-green {
            --accent: #10b981;
            --accent-dark: #065f46;
        }

        .theme-orange {
            --accent: #f59e0b;
            --accent-dark: #92400e;
        }

        .theme-pink {
            --accent: #ec4899;
            --accent-dark: #9d174d;
        }

        .nav-link.active {
            background: var(--accent);
            color: white !important;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: var(--accent);
            color: white !important;
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
        }

        .text-accent {
            color: var(--accent);
        }

        .custom-scroll::-webkit-scrollbar {
            width: 5px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .theme-default .custom-scroll::-webkit-scrollbar-thumb {
            background: #1e293b;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-up {
            animation: fadeInUp 0.4s ease-out forwards;
        }

        .avatar-container {
            position: relative;
            aspect-ratio: 1 / 1;
            border-radius: 1.5rem;
            overflow: hidden;
            background: var(--bg-input);
        }

        .avatar-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-group {
            position: relative;
        }

        .input-group i {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            padding-left: 3rem !important;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.37.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.45.4"
  }
}
</script>
</head>

<body class="antialiased overflow-hidden">
    <div id="app" class="h-screen w-full flex overflow-hidden"></div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";
        import { createClient } from "@supabase/supabase-js";

        const supabaseUrl = 'https://aweipematwhmvnyksrpu.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3ZWlwZW1hdHdobXZueWtzcnB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MTkzOTEsImV4cCI6MjA4NDM5NTM5MX0.0vLWeMbUg_tJSSEO63-Mkr-1DQHCITMy8ldEkIYHwlQ';
        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        const db = {
            get: (key, def) => {
                const val = localStorage.getItem('euro_' + key);
                try {
                    return val ? JSON.parse(val) : def;
                } catch (e) {
                    return def;
                }
            },
            set: (key, val) => localStorage.setItem('euro_' + key, JSON.stringify(val))
        };

        const initialUser = db.get('user', null);
        if (initialUser && initialUser.email.toLowerCase() === 'fabianacarile@gmail.com') {
            initialUser.role = 'admin';
        }

        let state = {
            view: window.location.hash.replace('#', '') || 'dashboard',
            user: initialUser,
            theme: db.get('theme', 'default'),
            mode: db.get('mode', 'dark'),
            geminiKey: db.get('gemini_key', ''),
            hospedagens: [],
            deslocamentos: [],
            checklist: [],
            membros: [],
            historico: [],
            passeios: [],
            aiSuggestions: db.get('ai_cache', {}),
            loadingAI: {},
            isMenuOpen: false,
            editingMembro: null,
            editingHospedagem: null,
            editingDeslocamento: null,
            editingHistorico: null,
            editingPasseio: null,
            isLoading: false
        };

        window.setState = (update) => {
            state = { ...state, ...update };
            const classList = ['antialiased', 'overflow-hidden'];
            if (state.theme && state.theme !== 'default') classList.push('theme-' + state.theme);
            if (state.mode === 'light') classList.push('light-mode');
            document.body.className = classList.join(' ');
            render();
        };

        const fetchData = async () => {
            if (!state.user) return;
            window.setState({ isLoading: true });
            try {
                const [h, d, c, m, hist, p] = await Promise.all([
                    supabase.from('hospedagens').select('*').order('data_chegada', { ascending: true }),
                    supabase.from('deslocamentos').select('*').order('data', { ascending: true }),
                    supabase.from('checklist_items').select('*').order('criado_em', { ascending: false }),
                    supabase.from('trip_members').select('*').order('nome', { ascending: true }),
                    supabase.from('historico_entries').select('*').order('data', { ascending: false }),
                    supabase.from('passeios').select('*').order('data', { ascending: true })
                ]);

                window.setState({
                    hospedagens: (h.data || []).map(x => ({ ...x, hotel: x.hotel_name, data_in: x.data_chegada, data_out: x.data_saida })),
                    deslocamentos: d.data || [],
                    checklist: (c.data || []).map(x => ({ ...x, text: x.titulo, done: x.status })),
                    membros: (m.data || []).map(x => ({ ...x, foto: x.foto_url })),
                    historico: (hist.data || []).map(x => ({ ...x, foto: x.foto_url, obs: x.observacoes })),
                    passeios: p.data || [],
                    isLoading: false
                });
            } catch (err) {
                console.error("Erro ao carregar dados do Supabase:", err);
                window.setState({ isLoading: false });
            }
        };

        const formatDate = (d) => {
            if (!d) return '---';
            const dateStr = d.includes('T') ? d.split('T')[0] : d;
            if (dateStr.length === 10 && dateStr.includes('-')) {
                const [y, m, day] = dateStr.split('-');
                return `${day}/${m}/${y}`;
            }
            return new Date(d).toLocaleDateString('pt-BR');
        };

        const getTripDateLabel = () => {
            if (!state.hospedagens || state.hospedagens.length === 0) return "ABRIL 2026";
            const sorted = [...state.hospedagens].sort((a, b) => {
                const da = a.data_in ? new Date(a.data_in + 'T12:00:00') : new Date(0);
                const db = b.data_in ? new Date(b.data_in + 'T12:00:00') : new Date(0);
                return da - db;
            });
            const firstDateStr = sorted[0]?.data_in;
            if (!firstDateStr) return "ABRIL 2026";
            const date = new Date(firstDateStr + 'T12:00:00');
            return date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }).toUpperCase();
        };

        const getCountdown = () => {
            const sortedHosp = [...state.hospedagens].sort((a, b) => {
                const da = a.data_in ? new Date(a.data_in + 'T12:00:00') : new Date(0);
                const db = b.data_in ? new Date(b.data_in + 'T12:00:00') : new Date(0);
                return da - db;
            });
            const baseDateStr = sortedHosp.length > 0 ? sortedHosp[0].data_in : '2026-04-01';

            const target = new Date(baseDateStr + 'T00:00:00');
            const now = new Date();
            now.setHours(0, 0, 0, 0);

            const diff = target - now;
            return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
        };

        window.nav = (v) => {
            window.location.hash = v;
            window.setState({
                view: v,
                isMenuOpen: false,
                editingMembro: null,
                editingHospedagem: null,
                editingDeslocamento: null,
                editingHistorico: null,
                editingPasseio: null
            });
        };

        window.login = async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const normalizedEmail = email.toLowerCase();

            window.setState({ isLoading: true });

            const { data, error } = await supabase.auth.signInWithPassword({
                email: normalizedEmail,
                password: password
            });

            if (error) {
                alert("Erro ao logar: " + error.message);
                window.setState({ isLoading: false });
                return;
            }

            const user = data.user;
            // Busca o perfil na tabela profiles para saber se √© admin
            const { data: profile } = await supabase.from('profiles').select('role').eq('id', user.id).single();

            const sessionUser = {
                email: user.email,
                name: user.email.split('@')[0],
                role: (profile?.role === 'admin' || normalizedEmail === 'fabianacarile@gmail.com') ? 'admin' : 'user',
                id: user.id
            };

            db.set('user', sessionUser);
            window.setState({ user: sessionUser, isLoading: false });
            fetchData();
        };

        window.logout = () => { localStorage.clear(); window.location.reload(); };

        window.saveGeminiKey = (e) => {
            e.preventDefault();
            const key = document.getElementById('gemini-key-input').value.trim();
            db.set('gemini_key', key);
            window.setState({ geminiKey: key });
            alert('Chave de API salva com sucesso!');
        };

        window.generateAISuggestions = async (id) => {
            const h = state.hospedagens.find(x => x.id === id);
            if (!h || state.loadingAI[id]) return;
            window.setState({ loadingAI: { ...state.loadingAI, [id]: true } });
            try {
                const apiKey = state.geminiKey;
                if (!apiKey) throw new Error("MISSING_API_KEY");
                const ai = new GoogleGenAI(apiKey);
                const prompt = `Atue como um concierge VIP. Para o hotel "${h.hotel}" em "${h.cidade}", forne√ßa sugest√µes √∫teis num raio de 500 metros (caminhada). Liste: esta√ß√µes de transporte, supermercados, farm√°cias e cafeterias para caf√© da manh√£. Seja conciso e pr√°tico.`;
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: prompt,
                });
                const text = response.text;
                const newCache = { ...state.aiSuggestions, [id]: text };
                db.set('ai_cache', newCache);
                window.setState({ aiSuggestions: newCache, loadingAI: { ...state.loadingAI, [id]: false } });
            } catch (error) {
                console.error(error);
                alert("Verifique sua chave Gemini em Ajustes.");
                window.setState({ loadingAI: { ...state.loadingAI, [id]: false } });
            }
        };

        window.openHospedagemEdit = (id = null) => {
            const hosp = id ? state.hospedagens.find(h => h.id === id) : null;
            window.setState({ editingHospedagem: hosp, view: 'hospedagem-edit' });
        };

        window.saveHospedagem = async (e) => {
            e.preventDefault();
            const payload = {
                cidade: document.getElementById('h-cidade').value,
                hotel_name: document.getElementById('h-hotel').value,
                data_chegada: document.getElementById('h-in').value,
                data_saida: document.getElementById('h-out').value,
                status: document.getElementById('h-status').value
            };

            if (state.editingHospedagem?.id) {
                payload.id = state.editingHospedagem.id;
            }

            const { error } = await supabase.from('hospedagens').upsert(payload);
            if (error) return alert("Erro ao salvar: " + error.message);

            fetchData();
            window.setState({ view: 'hospedagem', editingHospedagem: null });
        };

        window.openDeslocamentoEdit = (id = null) => {
            const desloc = id ? state.deslocamentos.find(d => d.id === id) : null;
            window.setState({ editingDeslocamento: desloc, view: 'deslocamento-edit' });
        };

        window.saveDeslocamento = async (e) => {
            e.preventDefault();
            const payload = {
                origem: document.getElementById('d-origem').value,
                destino: document.getElementById('d-destino').value,
                data: document.getElementById('d-data').value,
                meio: document.getElementById('d-meio').value,
                companhia: document.getElementById('d-cia').value,
                status: 'pago'
            };

            if (state.editingDeslocamento?.id) {
                payload.id = state.editingDeslocamento.id;
            }

            const { error } = await supabase.from('deslocamentos').upsert(payload);
            if (error) return alert("Erro ao salvar: " + error.message);

            fetchData();
            window.setState({ view: 'deslocamento', editingDeslocamento: null });
        };

        window.openMembroEdit = (id = null) => {
            const membro = id ? state.membros.find(m => m.id === id) : { id: '', nome: '', foto: null };
            window.setState({ editingMembro: { ...membro }, view: 'membros-edit' });
        };

        window.handleMembroPhoto = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => window.setState({ editingMembro: { ...state.editingMembro, foto: ev.target.result } });
            reader.readAsDataURL(file);
        };

        window.saveMembro = async (e) => {
            e.preventDefault();
            const payload = {
                nome: document.getElementById('m-nome').value,
                foto_url: state.editingMembro.foto
            };

            if (state.editingMembro?.id) {
                payload.id = state.editingMembro.id;
            }

            const { error } = await supabase.from('trip_members').upsert(payload);
            if (error) return alert("Erro ao salvar: " + error.message);

            fetchData();
            window.setState({ view: 'membros', editingMembro: null });
        };

        window.openHistoricoEdit = (id = null) => {
            const hist = id ? state.historico.find(h => h.id === id) : { id: '', local: '', obs: '', foto: null };
            window.setState({ editingHistorico: { ...hist }, view: 'historico-edit' });
        };

        window.handleHistoricoPhoto = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => window.setState({ editingHistorico: { ...state.editingHistorico, foto: ev.target.result } });
            reader.readAsDataURL(file);
        };

        window.saveHistorico = async (e) => {
            e.preventDefault();
            const payload = {
                local: document.getElementById('hist-local').value,
                observacoes: document.getElementById('hist-obs').value,
                foto_url: state.editingHistorico.foto,
                data: state.editingHistorico.data || new Date().toISOString()
            };

            if (state.editingHistorico?.id) {
                payload.id = state.editingHistorico.id;
            }

            const { error } = await supabase.from('historico_entries').upsert(payload);
            if (error) return alert("Erro ao salvar: " + error.message);

            fetchData();
            window.setState({ view: 'historico', editingHistorico: null });
        };

        window.openPasseioEdit = (id = null) => {
            const passeio = id ? state.passeios.find(p => p.id === id) : null;
            window.setState({ editingPasseio: passeio, view: 'passeio-edit' });
        };

        window.savePasseio = async (e) => {
            e.preventDefault();
            const payload = {
                data: document.getElementById('p-data').value,
                horario_saida: document.getElementById('p-hora').value,
                origem: document.getElementById('p-origem').value,
                locais_visitar: document.getElementById('p-locais').value
            };

            if (state.editingPasseio?.id) {
                payload.id = state.editingPasseio.id;
            }

            const { error } = await supabase.from('passeios').upsert(payload);
            if (error) return alert("Erro ao salvar: " + error.message);

            fetchData();
            window.setState({ view: 'passeio', editingPasseio: null });
        };

        window.toggleCheck = async (id) => {
            const item = state.checklist.find(x => x.id === id);
            const { error } = await supabase.from('checklist_items').update({ status: !item.done }).eq('id', id);
            if (error) return alert("Erro ao atualizar: " + error.message);
            fetchData();
        };

        window.addCheck = async (e) => {
            e.preventDefault();
            const input = document.getElementById('c-input');
            const { error } = await supabase.from('checklist_items').insert({
                titulo: input.value,
                status: false
            });
            if (error) return alert("Erro ao adicionar: " + error.message);
            input.value = '';
            fetchData();
        };

        window.deleteItem = async (type, id) => {
            if (!confirm('Deseja excluir permanentemente?')) return;
            const tableMap = {
                'hospedagens': 'hospedagens',
                'deslocamentos': 'deslocamentos',
                'checklist': 'checklist_items',
                'membros': 'trip_members',
                'historico': 'historico_entries',
                'passeios': 'passeios'
            };
            const { error } = await supabase.from(tableMap[type]).delete().eq('id', id);
            if (error) return alert("Erro ao excluir: " + error.message);
            fetchData();
        };

        function Sidebar() {
            const links = [
                { id: 'dashboard', icon: 'fa-chart-pie', label: 'Resumo' },
                { id: 'hospedagem', icon: 'fa-hotel', label: 'Hospedagem' },
                { id: 'deslocamento', icon: 'fa-route', label: 'Deslocamentos' },
                { id: 'passeio', icon: 'fa-binoculars', label: 'Passeios' },
                { id: 'checklist', icon: 'fa-list-check', label: 'Checklist' },
                { id: 'historico', icon: 'fa-camera-retro', label: 'Hist√≥rico' },
                { id: 'membros', icon: 'fa-users', label: 'Membros' },
                { id: 'settings', icon: 'fa-cog', label: 'Ajustes' }
            ];

            return `
                ${state.isMenuOpen ? `<div onclick="setState({isMenuOpen: false})" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[45] lg:hidden"></div>` : ''}
                <aside class="w-72 glass border-r flex flex-col fixed lg:static h-full z-50 transition-all duration-300 transform ${state.isMenuOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}">
                    <div class="p-8 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 btn-primary rounded-lg flex items-center justify-center shadow-lg"><i class="fa-solid fa-earth-europe text-white"></i></div>
                            <span class="text-xl font-black tracking-tighter uppercase">Euro<span class="text-accent">26</span></span>
                        </div>
                        <button onclick="setState({isMenuOpen: false})" class="lg:hidden text-slate-500 hover:text-white transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
                    </div>
                    <nav class="flex-1 px-4 space-y-1 overflow-y-auto custom-scroll">
                        ${links.map(l => `
                            <button onclick="nav('${l.id}')" class="nav-link w-full flex items-center gap-4 px-6 py-4 rounded-xl font-bold transition-all ${state.view.includes(l.id) ? 'active' : 'text-slate-400 hover:bg-slate-800/50 hover:text-white'}">
                                <i class="fa-solid ${l.icon} w-5"></i><span class="text-[10px] uppercase tracking-widest">${l.label}</span>
                            </button>
                        `).join('')}
                    </nav>
                    <div class="p-6 border-t border-slate-800/30">
                        <div class="flex items-center gap-3 p-4 glass rounded-xl mb-4">
                            <div class="w-8 h-8 rounded-full btn-primary flex items-center justify-center font-black text-xs uppercase shadow-md">${(state.user?.name || 'V')[0]}</div>
                            <div class="flex-1 overflow-hidden">
                                <p class="text-[10px] font-black uppercase truncate">${state.user?.name}</p>
                                <p class="text-[8px] text-slate-500 font-bold uppercase tracking-widest">${state.user?.role}</p>
                            </div>
                        </div>
                        <button onclick="logout()" class="w-full py-3 text-red-500 font-black text-[9px] uppercase tracking-widest hover:bg-red-500/10 rounded-lg transition-all flex items-center justify-center gap-2"><i class="fa-solid fa-power-off"></i> Sair do Painel</button>
                    </div>
                </aside>
            `;
        }

        const Views = {
            dashboard: () => `
                <div class="animate-fade-up">
                    <h2 class="text-2xl md:text-3xl lg:text-4xl font-black tracking-tighter mb-8 md:mb-10 flex items-center gap-4">
                        <i class="fa-solid fa-chart-line text-accent"></i> Resumo da Viagem
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <div class="glass p-6 md:p-8 rounded-2xl relative overflow-hidden group">
                            <i class="fa-solid fa-clock absolute -right-4 -bottom-4 text-7xl opacity-5 text-accent transition-transform group-hover:scale-110"></i>
                            <p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2">Contagem Regressiva</p>
                            <div class="text-4xl md:text-5xl lg:text-6xl font-black text-accent">${getCountdown()}</div>
                            <p class="text-xs font-bold text-slate-400 mt-2 uppercase">Dias para o embarque</p>
                        </div>
                        <div class="glass p-6 md:p-8 rounded-2xl relative overflow-hidden group">
                            <i class="fa-solid fa-bed absolute -right-4 -bottom-4 text-7xl opacity-5 text-emerald-500 transition-transform group-hover:scale-110"></i>
                            <p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2">Hospedagens</p>
                            <div class="text-4xl md:text-5xl lg:text-6xl font-black text-emerald-500">${state.hospedagens.length}</div>
                            <p class="text-xs font-bold text-slate-400 mt-2 uppercase">Estadias Confirmadas</p>
                        </div>
                        <div class="glass p-6 md:p-8 rounded-2xl sm:col-span-2 lg:col-span-1 relative overflow-hidden group">
                            <i class="fa-solid fa-check-double absolute -right-4 -bottom-4 text-7xl opacity-5 text-pink-500 transition-transform group-hover:scale-110"></i>
                            <p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2">Checklist</p>
                            <div class="text-4xl md:text-5xl lg:text-6xl font-black text-pink-500">${state.checklist.filter(x => x.done).length}/${state.checklist.length}</div>
                            <p class="text-xs font-bold text-slate-400 mt-2 uppercase">Tarefas Finalizadas</p>
                        </div>
                    </div>
                </div>
            `,
            hospedagem: () => `
                <div class="animate-fade-up">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 md:mb-10">
                        <h2 class="text-2xl md:text-4xl font-black tracking-tighter flex items-center gap-4">
                            <i class="fa-solid fa-hotel text-accent"></i> Hospedagens
                        </h2>
                        ${state.user.role === 'admin' ? `<button onclick="openHospedagemEdit()" class="w-full sm:w-auto btn-primary px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest text-white shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Adicionar Estadia</button>` : ''}
                    </div>
                    <div class="grid grid-cols-1 gap-6">
                        ${state.hospedagens.map(h => `
                            <div class="glass p-6 md:p-8 rounded-2xl flex flex-col gap-6 group hover:border-accent transition-all relative overflow-hidden">
                                <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                                    <div class="flex-1">
                                        <p class="text-xs font-black text-accent uppercase tracking-widest mb-1 flex items-center gap-2"><i class="fa-solid fa-location-dot"></i> ${h.cidade}</p>
                                        <h3 class="text-xl md:text-2xl font-black">${h.hotel}</h3>
                                        <p class="text-xs text-slate-500 mt-2 uppercase font-bold flex items-center gap-2">
                                            <i class="fa-regular fa-calendar"></i> ${formatDate(h.data_in)} <i class="fa-solid fa-arrow-right-long text-[10px]"></i> ${formatDate(h.data_out)}
                                        </p>
                                    </div>
                                    <div class="flex gap-2 w-full sm:w-auto">
                                        <button onclick="generateAISuggestions('${h.id}')" title="Sugest√µes IA" class="flex-1 sm:flex-none p-3 md:p-4 rounded-xl bg-accent/10 text-accent hover:bg-accent hover:text-white transition-all shadow-sm">
                                            <i class="fa-solid ${state.loadingAI[h.id] ? 'fa-circle-notch animate-spin' : 'fa-wand-magic-sparkles'} text-sm"></i>
                                        </button>
                                        ${state.user.role === 'admin' ? `
                                            <button onclick="openHospedagemEdit('${h.id}')" title="Editar" class="flex-1 sm:flex-none p-3 md:p-4 rounded-xl bg-slate-800/10 text-slate-500 hover:bg-accent hover:text-white hover:scale-105 transition-all shadow-sm border border-slate-500/10"><i class="fa-solid fa-pen text-sm"></i></button>
                                            <button onclick="deleteItem('hospedagens', '${h.id}')" title="Excluir" class="flex-1 sm:flex-none text-red-500 hover:bg-red-500 hover:text-white p-3 md:p-4 rounded-xl hover:scale-105 transition-all shadow-sm border border-red-500/10"><i class="fa-solid fa-trash"></i></button>
                                        ` : ''}
                                    </div>
                                </div>
                                ${state.aiSuggestions[h.id] ? `
                                    <div class="bg-blue-50/50 dark:bg-slate-900/60 p-6 md:p-8 rounded-2xl border border-blue-100 dark:border-white/5 animate-fade-up">
                                        <p class="text-[10px] font-black uppercase tracking-widest text-accent mb-4 flex items-center gap-2"><i class="fa-solid fa-robot"></i> Guia de Arredores (IA Concierge)</p>
                                        <div class="text-[13px] leading-relaxed text-slate-700 dark:text-slate-200 whitespace-pre-wrap">${state.aiSuggestions[h.id]}</div>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `,
            'hospedagem-edit': () => `
                <div class="max-w-xl mx-auto animate-fade-up">
                    <h2 class="text-2xl md:text-3xl font-black mb-8 flex items-center gap-4">
                        <i class="fa-solid fa-edit text-accent"></i> ${state.editingHospedagem ? 'Editar' : 'Nova'} Hospedagem
                    </h2>
                    <form onsubmit="saveHospedagem(event)" class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Cidade de Destino</label>
                            <div class="input-group">
                                <i class="fa-solid fa-city"></i>
                                <input required id="h-cidade" value="${state.editingHospedagem?.cidade || ''}" placeholder="Ex: Paris, Fran√ßa" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Nome da Acomoda√ß√£o</label>
                            <div class="input-group">
                                <i class="fa-solid fa-hotel"></i>
                                <input required id="h-hotel" value="${state.editingHospedagem?.hotel || ''}" placeholder="Ex: Ritz Paris" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Data de Entrada</label>
                                <div class="input-group">
                                    <i class="fa-regular fa-calendar-check"></i>
                                    <input type="date" required id="h-in" value="${state.editingHospedagem?.data_in || ''}" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Data de Sa√≠da</label>
                                <div class="input-group">
                                    <i class="fa-regular fa-calendar-xmark"></i>
                                    <input type="date" required id="h-out" value="${state.editingHospedagem?.data_out || ''}" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Status da Reserva</label>
                            <div class="input-group">
                                <i class="fa-solid fa-info-circle"></i>
                                <select id="h-status" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold appearance-none shadow-inner">
                                    <option value="confirmado" ${state.editingHospedagem?.status === 'confirmado' ? 'selected' : ''}>Confirmado</option>
                                    <option value="pendente" ${state.editingHospedagem?.status === 'pendente' ? 'selected' : ''}>Pendente / Em Aberto</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex gap-4 pt-6">
                            <button type="button" onclick="nav('hospedagem')" class="flex-1 py-5 bg-slate-800/10 text-slate-500 rounded-xl font-black text-[10px] uppercase tracking-widest border border-slate-500/10 hover:bg-slate-800/20 transition-all">Cancelar</button>
                            <button type="submit" class="flex-1 py-5 btn-primary rounded-xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-accent/20 flex items-center justify-center gap-2"><i class="fa-solid fa-save"></i> Salvar Estadia</button>
                        </div>
                    </form>
                </div>
            `,
            deslocamento: () => `
                <div class="animate-fade-up">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 md:mb-10">
                        <h2 class="text-2xl md:text-4xl font-black tracking-tighter flex items-center gap-4">
                            <i class="fa-solid fa-route text-accent"></i> Deslocamentos
                        </h2>
                        ${state.user.role === 'admin' ? `<button onclick="openDeslocamentoEdit()" class="w-full sm:w-auto btn-primary px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest text-white shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Novo Deslocamento</button>` : ''}
                    </div>
                    <div class="relative border-l-2 border-slate-800/30 ml-2 sm:ml-6 space-y-8">
                        ${state.deslocamentos.map(d => `
                            <div class="relative pl-12 group">
                                <div class="absolute -left-[11px] top-0 w-5 h-5 rounded-full bg-accent shadow-lg shadow-accent/20 group-hover:scale-125 transition-transform duration-300"></div>
                                <div class="glass p-6 md:p-8 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-6 hover:border-accent transition-all">
                                    <div class="flex items-center gap-8">
                                        <div class="text-center">
                                            <p class="text-[9px] font-black uppercase text-slate-500 mb-1 tracking-widest">Origem</p>
                                            <p class="text-xl font-black">${d.origem}</p>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <i class="fa-solid ${d.meio === 'avi√£o' ? 'fa-plane' : d.meio === 'carro' ? 'fa-car' : 'fa-train'} text-accent text-xl animate-pulse"></i>
                                            <div class="w-12 h-px bg-slate-800/30 mt-2"></div>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-[9px] font-black uppercase text-slate-500 mb-1 tracking-widest">Destino</p>
                                            <p class="text-xl font-black">${d.destino}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-6">
                                        <div class="text-right">
                                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center justify-end gap-2"><i class="fa-regular fa-calendar"></i> ${formatDate(d.data?.split('T')[0])}</p>
                                            <p class="text-[10px] font-bold text-slate-400 uppercase flex items-center justify-end gap-2"><i class="fa-solid fa-ticket"></i> ${d.companhia || 'Particular'}</p>
                                        </div>
                                        ${state.user.role === 'admin' ? `
                                            <div class="flex gap-2">
                                                <button onclick="openDeslocamentoEdit('${d.id}')" title="Editar" class="w-10 h-10 rounded-xl bg-slate-800/10 text-slate-500 flex items-center justify-center hover:bg-accent hover:text-white transition-all border border-slate-500/10 shadow-sm"><i class="fa-solid fa-pen text-xs"></i></button>
                                                <button onclick="deleteItem('deslocamentos', '${d.id}')" title="Excluir" class="w-10 h-10 rounded-xl bg-red-500/10 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all border border-red-500/10 shadow-sm"><i class="fa-solid fa-trash text-xs"></i></button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `,
            'deslocamento-edit': () => `
                <div class="max-w-xl mx-auto animate-fade-up">
                    <h2 class="text-2xl md:text-3xl font-black mb-8 flex items-center gap-4">
                        <i class="fa-solid fa-route text-accent"></i> ${state.editingDeslocamento ? 'Editar' : 'Novo'} Deslocamento
                    </h2>
                    <form onsubmit="saveDeslocamento(event)" class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Partida de</label>
                                <div class="input-group">
                                    <i class="fa-solid fa-plane-departure"></i>
                                    <input required id="d-origem" value="${state.editingDeslocamento?.origem || ''}" placeholder="Ex: Brasil" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold shadow-inner">
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Chegada em</label>
                                <div class="input-group">
                                    <i class="fa-solid fa-plane-arrival"></i>
                                    <input required id="d-destino" value="${state.editingDeslocamento?.destino || ''}" placeholder="Ex: Paris" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold shadow-inner">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Data e Hor√°rio</label>
                            <div class="input-group">
                                <i class="fa-regular fa-clock"></i>
                                <input type="datetime-local" required id="d-data" value="${state.editingDeslocamento?.data || ''}" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold text-white shadow-inner">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Meio de Transporte</label>
                                <div class="input-group">
                                    <i class="fa-solid fa-van-shuttle"></i>
                                    <select id="d-meio" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold appearance-none shadow-inner">
                                        <option value="avi√£o" ${state.editingDeslocamento?.meio === 'avi√£o' ? 'selected' : ''}>‚úàÔ∏è Avi√£o</option>
                                        <option value="trem" ${state.editingDeslocamento?.meio === 'trem' ? 'selected' : ''}>üöÜ Trem (Eurostar/TGV)</option>
                                        <option value="carro" ${state.editingDeslocamento?.meio === 'carro' ? 'selected' : ''}>üöó Carro / Uber / Transfer</option>
                                    </select>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Companhia / Voo / Ref</label>
                                <div class="input-group">
                                    <i class="fa-solid fa-building"></i>
                                    <input id="d-cia" value="${state.editingDeslocamento?.companhia || ''}" placeholder="Ex: Air France AF123" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold shadow-inner">
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 pt-6">
                            <button type="button" onclick="nav('deslocamento')" class="flex-1 py-5 bg-slate-800/10 text-slate-500 rounded-xl font-black text-[10px] uppercase tracking-widest border border-slate-500/10 hover:bg-slate-800/20 transition-all">Cancelar</button>
                            <button type="submit" class="flex-1 py-5 btn-primary rounded-xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-accent/20 flex items-center justify-center gap-2"><i class="fa-solid fa-save"></i> Salvar Deslocamento</button>
                        </div>
                    </form>
                </div>
            `,
            checklist: () => `
                <div class="max-w-2xl mx-auto animate-fade-up">
                    <h2 class="text-2xl md:text-4xl font-black tracking-tighter mb-10 flex items-center gap-4">
                        <i class="fa-solid fa-list-check text-accent"></i> Checklist da Expedi√ß√£o
                    </h2>
                    <form onsubmit="addCheck(event)" class="flex gap-3 mb-10">
                        <div class="input-group flex-1">
                            <i class="fa-solid fa-plus-circle"></i>
                            <input id="c-input" required placeholder="O que precisamos fazer?" class="w-full bg-slate-900 p-5 rounded-2xl outline-none focus:border-accent font-bold text-sm shadow-inner transition-all">
                        </div>
                        <button type="submit" class="btn-primary px-10 rounded-2xl font-black text-xs uppercase shadow-lg flex items-center gap-2">Adicionar</button>
                    </form>
                    <div class="space-y-3">
                        ${state.checklist.map(item => `
                            <div class="glass p-5 rounded-2xl flex items-center justify-between group transition-all hover:bg-slate-800/5">
                                <div class="flex items-center gap-5">
                                    <button onclick="toggleCheck('${item.id}')" title="${item.done ? 'Desmarcar' : 'Concluir'}" class="w-10 h-10 rounded-full border-2 transition-all flex items-center justify-center ${item.done ? 'bg-emerald-500 border-emerald-500 shadow-lg shadow-emerald-500/20' : 'border-slate-700 hover:border-accent'}">
                                        ${item.done ? '<i class="fa-solid fa-check text-white text-xs"></i>' : ''}
                                    </button>
                                    <span class="text-sm font-bold tracking-tight transition-all ${item.done ? 'line-through text-slate-500 italic' : ''}">${item.text}</span>
                                </div>
                                <button onclick="deleteItem('checklist', '${item.id}')" title="Remover" class="text-red-500/40 p-2 opacity-0 group-hover:opacity-100 hover:text-red-500 transition-all"><i class="fa-solid fa-trash-can"></i></button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `,
            historico: () => `
                <div class="animate-fade-up">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
                        <h2 class="text-2xl md:text-4xl font-black tracking-tighter flex items-center gap-4">
                            <i class="fa-solid fa-camera-retro text-accent"></i> Hist√≥rico da Viagem
                        </h2>
                        <button onclick="openHistoricoEdit()" class="w-full sm:w-auto btn-primary px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest text-white shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Nova Mem√≥ria</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        ${state.historico.map(h => `
                            <div class="glass rounded-[2rem] overflow-hidden group hover:border-accent transition-all flex flex-col">
                                ${h.foto ? `<div class="aspect-video overflow-hidden"><img src="${h.foto}" class="w-full h-full object-cover transition-transform group-hover:scale-110"></div>` : ''}
                                <div class="p-8">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="text-xl font-black tracking-tight">${h.local}</h3>
                                            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">${formatDate(h.data)}</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="openHistoricoEdit('${h.id}')" title="Editar" class="w-8 h-8 rounded-lg bg-slate-800/10 text-slate-500 hover:bg-accent hover:text-white transition-all flex items-center justify-center"><i class="fa-solid fa-pen text-[10px]"></i></button>
                                            <button onclick="deleteItem('historico', '${h.id}')" title="Excluir" class="w-8 h-8 rounded-lg bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center"><i class="fa-solid fa-trash text-[10px]"></i></button>
                                        </div>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400 italic">"${h.obs}"</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `,
            'historico-edit': () => `
                <div class="max-w-xl mx-auto animate-fade-up">
                    <h2 class="text-2xl md:text-3xl font-black mb-10 flex items-center gap-4">
                        <i class="fa-solid fa-camera-retro text-accent"></i> ${state.editingHistorico?.id ? 'Editar' : 'Nova'} Mem√≥ria
                    </h2>
                    <form onsubmit="saveHistorico(event)" class="space-y-8">
                        <div class="flex flex-col items-center">
                            <div class="w-full h-64 glass rounded-[2rem] border-4 border-dashed border-slate-700/50 hover:border-accent cursor-pointer group transition-all relative overflow-hidden" onclick="document.getElementById('hist-foto-input').click()">
                                ${state.editingHistorico?.foto ? `<img src="${state.editingHistorico.foto}" class="w-full h-full object-cover">` : `<div class="h-full flex flex-col items-center justify-center text-slate-500 group-hover:text-accent transition-colors"><i class="fa-solid fa-camera text-5xl mb-4"></i><span class="text-[9px] font-black uppercase tracking-widest">Tirar Foto ou Galeria</span></div>`}
                                <input type="file" id="hist-foto-input" class="hidden" accept="image/*" capture="environment" onchange="handleHistoricoPhoto(event)">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-4 tracking-widest">Local / Momento</label>
                            <div class="input-group">
                                <i class="fa-solid fa-location-dot"></i>
                                <input required id="hist-local" value="${state.editingHistorico?.local || ''}" placeholder="Ex: P√¥r do sol na Torre Eiffel" class="w-full bg-slate-900 p-6 rounded-2xl outline-none focus:border-accent font-bold shadow-inner">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-4 tracking-widest">Observa√ß√µes</label>
                            <div class="input-group">
                                <i class="fa-solid fa-pen-nib"></i>
                                <textarea required id="hist-obs" rows="4" placeholder="O que voc√™ sentiu nesse momento?" class="w-full bg-slate-900 p-6 rounded-2xl outline-none focus:border-accent font-bold shadow-inner resize-none">${state.editingHistorico?.obs || ''}</textarea>
                            </div>
                        </div>
                        <div class="flex gap-4 pt-4">
                            <button type="button" onclick="nav('historico')" class="flex-1 py-5 bg-slate-800/10 text-slate-500 rounded-2xl font-black text-[10px] uppercase tracking-widest border border-slate-500/10">Cancelar</button>
                            <button type="submit" class="flex-1 py-5 btn-primary rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-2xl flex items-center justify-center gap-2"><i class="fa-solid fa-save"></i> Registrar Mem√≥ria</button>
                        </div>
                    </form>
                </div>
            `,
            passeio: () => `
                <div class="animate-fade-up">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8 md:mb-10">
                        <h2 class="text-2xl md:text-4xl font-black tracking-tighter flex items-center gap-4">
                            <i class="fa-solid fa-binoculars text-accent"></i> Passeios
                        </h2>
                        ${state.user.role === 'admin' ? `<button onclick="openPasseioEdit()" class="w-full sm:w-auto btn-primary px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest text-white shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Novo Passeio</button>` : ''}
                    </div>
                    <div class="grid grid-cols-1 gap-6">
                        ${state.passeios.map(p => `
                            <div class="glass p-6 md:p-8 rounded-2xl flex flex-col gap-4 group hover:border-accent transition-all relative overflow-hidden">
                                <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="px-3 py-1 bg-accent/10 text-accent text-[10px] font-black uppercase rounded-full tracking-widest">${formatDate(p.data)}</span>
                                            <span class="text-xs font-bold text-slate-500 uppercase"><i class="fa-regular fa-clock mr-1"></i> sa√≠da: ${p.horario_saida?.slice(0, 5) || '--:--'}</span>
                                        </div>
                                        <h3 class="text-xl font-black mb-1">Partida de: ${p.origem}</h3>
                                        <div class="mt-4">
                                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-map-marked-alt text-accent"></i> Roteiro do Dia</p>
                                            <div class="text-sm font-medium text-slate-400 leading-relaxed">${p.locais_visitar}</div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 w-full sm:w-auto">
                                        ${state.user.role === 'admin' ? `
                                            <button onclick="openPasseioEdit('${p.id}')" title="Editar" class="flex-1 sm:flex-none p-3 md:p-4 rounded-xl bg-slate-800/10 text-slate-500 hover:bg-accent hover:text-white transition-all shadow-sm border border-slate-500/10"><i class="fa-solid fa-pen text-sm"></i></button>
                                            <button onclick="deleteItem('passeios', '${p.id}')" title="Excluir" class="flex-1 sm:flex-none text-red-500 hover:bg-red-500 hover:text-white p-3 md:p-4 rounded-xl transition-all shadow-sm border border-red-500/10"><i class="fa-solid fa-trash"></i></button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `,
            'passeio-edit': () => `
                <div class="max-w-xl mx-auto animate-fade-up">
                    <h2 class="text-2xl md:text-3xl font-black mb-8 flex items-center gap-4">
                        <i class="fa-solid fa-binoculars text-accent"></i> ${state.editingPasseio ? 'Editar' : 'Novo'} Passeio
                    </h2>
                    <form onsubmit="savePasseio(event)" class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Dia do Passeio</label>
                                <div class="input-group">
                                    <i class="fa-regular fa-calendar"></i>
                                    <input type="date" required id="p-data" value="${state.editingPasseio?.data || ''}" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Hor√°rio de Sa√≠da</label>
                                <div class="input-group">
                                    <i class="fa-regular fa-clock"></i>
                                    <input type="time" required id="p-hora" value="${state.editingPasseio?.horario_saida || ''}" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Local de Origem</label>
                            <div class="input-group">
                                <i class="fa-solid fa-hotel"></i>
                                <input required id="p-origem" value="${state.editingPasseio?.origem || ''}" placeholder="Ex: Lobby do Hotel ou Esta√ß√£o Central" class="w-full bg-slate-900 p-5 rounded-xl outline-none focus:border-accent font-bold transition-all shadow-inner">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-2 tracking-widest">Locais a Visitar / Roteiro</label>
                            <div class="input-group">
                                <i class="fa-solid fa-map-location-dot"></i>
                                <textarea required id="p-locais" rows="5" placeholder="Descreva os pontos que ser√£o visitados..." class="w-full bg-slate-900 p-6 rounded-2xl outline-none focus:border-accent font-bold shadow-inner resize-none">${state.editingPasseio?.locais_visitar || ''}</textarea>
                            </div>
                        </div>
                        <div class="flex gap-4 pt-6">
                            <button type="button" onclick="nav('passeio')" class="flex-1 py-5 bg-slate-800/10 text-slate-500 rounded-xl font-black text-[10px] uppercase tracking-widest border border-slate-500/10 hover:bg-slate-800/20 transition-all">Cancelar</button>
                            <button type="submit" class="flex-1 py-5 btn-primary rounded-xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-accent/20 flex items-center justify-center gap-2"><i class="fa-solid fa-save"></i> Salvar Passeio</button>
                        </div>
                    </form>
                </div>
            `,
            membros: () => `
                <div class="animate-fade-up">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-10">
                        <h2 class="text-2xl md:text-4xl font-black tracking-tighter flex items-center gap-4">
                            <i class="fa-solid fa-users text-accent"></i> Membros do Grupo
                        </h2>
                        ${state.user.role === 'admin' ? `<button onclick="openMembroEdit()" class="w-full sm:w-auto btn-primary px-10 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-user-plus"></i> Convidar Membro</button>` : ''}
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-8">
                        ${state.membros.map(m => `
                            <div class="glass p-8 rounded-[2.5rem] text-center relative group overflow-hidden hover:border-accent transition-all duration-300">
                                <div class="w-24 sm:w-28 mx-auto mb-6 avatar-container border-2 border-slate-800/30 shadow-2xl transition-all group-hover:border-accent group-hover:scale-105">
                                    ${m.foto ? `<img src="${m.foto}" class="avatar-img">` : `<div class="avatar-img flex items-center justify-center bg-slate-800 text-3xl font-black text-accent uppercase tracking-tighter shadow-inner">${m.nome[0]}</div>`}
                                </div>
                                <h3 class="font-black text-xs sm:text-sm text-white truncate uppercase tracking-[0.2em] mb-1">${m.nome}</h3>
                                ${state.user.role === 'admin' ? `
                                    <div class="absolute inset-0 bg-slate-950/90 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-4 transition-all duration-500 backdrop-blur-md">
                                        <button onclick="openMembroEdit('${m.id}')" title="Editar" class="w-12 h-12 rounded-2xl bg-accent text-white hover:scale-110 transition-transform shadow-xl flex items-center justify-center"><i class="fa-solid fa-pen text-sm"></i></button>
                                        <button onclick="deleteItem('membros', '${m.id}')" title="Excluir" class="w-12 h-12 rounded-2xl bg-red-500 text-white hover:scale-110 transition-transform shadow-xl flex items-center justify-center"><i class="fa-solid fa-trash text-sm"></i></button>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `,
            'membros-edit': () => `
                <div class="max-w-xl mx-auto animate-fade-up text-center">
                    <h2 class="text-2xl md:text-3xl font-black mb-10 flex items-center justify-center gap-4">
                        <i class="fa-solid fa-user-circle text-accent"></i> ${state.editingMembro?.id ? 'Editar' : 'Novo'} Participante
                    </h2>
                    <form onsubmit="saveMembro(event)" class="space-y-10">
                        <div class="flex flex-col items-center">
                            <div class="w-44 avatar-container border-4 border-dashed border-slate-700/50 hover:border-accent cursor-pointer group transition-all relative" onclick="document.getElementById('m-foto-input').click()">
                                ${state.editingMembro?.foto ? `<img src="${state.editingMembro.foto}" class="avatar-img">` : `<div class="avatar-img flex flex-col items-center justify-center text-slate-500 group-hover:text-accent transition-colors"><i class="fa-solid fa-camera text-4xl mb-3"></i><span class="text-[9px] font-black uppercase tracking-widest">Enviar Foto</span></div>`}
                                <input type="file" id="m-foto-input" class="hidden" accept="image/*" onchange="handleMembroPhoto(event)">
                            </div>
                        </div>
                        <div class="space-y-2 text-left">
                            <label class="text-[9px] uppercase font-black text-slate-500 ml-4 tracking-widest">Nome do Membro</label>
                            <div class="input-group">
                                <i class="fa-solid fa-signature"></i>
                                <input required id="m-nome" value="${state.editingMembro?.nome || ''}" placeholder="Nome para exibi√ß√£o" class="w-full bg-slate-900 p-6 rounded-2xl outline-none focus:border-accent font-bold text-center text-lg shadow-inner">
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <button type="button" onclick="nav('membros')" class="flex-1 py-5 bg-slate-800/10 text-slate-500 rounded-2xl font-black text-[10px] uppercase tracking-widest border border-slate-500/10">Cancelar</button>
                            <button type="submit" class="flex-1 py-5 btn-primary rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-2xl shadow-accent/20 flex items-center justify-center gap-2"><i class="fa-solid fa-check-circle"></i> Confirmar Membro</button>
                        </div>
                    </form>
                </div>
            `,
            settings: () => `
                <div class="max-w-xl mx-auto animate-fade-up space-y-12">
                    <h2 class="text-2xl md:text-4xl font-black mb-10 flex items-center gap-4">
                        <i class="fa-solid fa-cog text-accent"></i> Ajustes Gerais
                    </h2>

                    <div class="glass p-8 rounded-[2.5rem] shadow-xl">
                        <h3 class="text-xl font-bold mb-8 flex items-center gap-3"><i class="fa-solid fa-circle-half-stroke text-accent"></i> Modo de Apar√™ncia</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="setState({mode: 'light'}); db.set('mode', 'light')" class="p-5 rounded-2xl border-2 transition-all font-black text-[10px] uppercase tracking-widest flex items-center justify-between group ${state.mode === 'light' ? 'border-accent bg-accent/10 text-accent shadow-md' : 'border-slate-800/30 text-slate-500 hover:border-slate-600'}">
                                <span>Modo Claro</span>
                                <i class="fa-solid fa-sun text-sm"></i>
                            </button>
                            <button onclick="setState({mode: 'dark'}); db.set('mode', 'dark')" class="p-5 rounded-2xl border-2 transition-all font-black text-[10px] uppercase tracking-widest flex items-center justify-between group ${state.mode === 'dark' ? 'border-accent bg-accent/10 text-accent shadow-md' : 'border-slate-800/30 text-slate-500 hover:border-slate-600'}">
                                <span>Modo Escuro</span>
                                <i class="fa-solid fa-moon text-sm"></i>
                            </button>
                        </div>
                    </div>

                    <div class="glass p-8 rounded-[2.5rem] shadow-xl">
                        <h3 class="text-xl font-bold mb-8 flex items-center gap-3"><i class="fa-solid fa-paint-brush text-accent"></i> Estilo & Cores</h3>
                        <div class="grid grid-cols-2 gap-4">
                            ${['default', 'green', 'orange', 'pink'].map(t => `
                                <button onclick="setState({theme: '${t}'}); db.set('theme', '${t}')" class="p-5 rounded-2xl border-2 transition-all font-black text-[10px] uppercase tracking-widest flex items-center justify-between group ${state.theme === t ? 'border-accent bg-accent/10 text-accent shadow-md' : 'border-slate-800/30 text-slate-500 hover:border-slate-600'}">
                                    <span>${t === 'default' ? 'Oceano Blue' : t === 'green' ? 'Amazon Green' : t === 'orange' ? 'Volcano Energy' : 'Spring Bloom'}</span>
                                    <i class="fa-solid ${state.theme === t ? 'fa-check-circle' : 'fa-circle-notch opacity-10'}"></i>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="glass p-8 rounded-[2.5rem] border-l-4 border-blue-500 shadow-xl relative overflow-hidden">
                        <i class="fa-solid fa-brain absolute -right-6 -bottom-6 text-9xl opacity-5 text-accent"></i>
                        <h3 class="text-xl font-bold mb-6 flex items-center gap-3 relative z-10"><i class="fa-solid fa-robot text-accent"></i> IA Concierge (Gemini)</h3>
                        <form onsubmit="saveGeminiKey(event)" class="space-y-4 relative z-10">
                            <div class="input-group">
                                <i class="fa-solid fa-key"></i>
                                <input type="password" id="gemini-key-input" placeholder="Google AI Studio Key..." value="${state.geminiKey}" class="w-full bg-slate-900 rounded-2xl px-6 py-5 outline-none focus:border-blue-500 font-bold text-sm shadow-inner">
                            </div>
                            <button type="submit" class="w-full py-5 btn-primary rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-shield-check"></i> Autenticar IA</button>
                        </form>
                    </div>
                </div>
            `
        };

        function render() {
            const app = document.getElementById('app');
            if (!state.user) {
                app.innerHTML = `
                    <div class="h-screen w-full flex items-center justify-center bg-slate-950 p-6 overflow-hidden relative">
                        <div class="absolute inset-0 opacity-10 pointer-events-none">
                            <div class="absolute top-10 left-10 w-96 h-96 bg-accent rounded-full blur-[150px]"></div>
                            <div class="absolute bottom-10 right-10 w-96 h-96 bg-blue-500 rounded-full blur-[150px]"></div>
                        </div>
                        <div class="w-full max-w-md glass p-12 rounded-[3rem] text-center animate-fade-up shadow-2xl relative z-10">
                            <div class="w-24 h-24 btn-primary rounded-[2.5rem] flex items-center justify-center mx-auto mb-10 shadow-2xl rotate-12 transition-transform hover:rotate-0 duration-500">
                                <i class="fa-solid fa-plane-departure text-4xl text-white"></i>
                            </div>
                            <h1 class="text-4xl font-black tracking-tighter mb-4">Euro26</h1>
                            <form onsubmit="login(event)" class="text-left space-y-6">
                                <div class="space-y-2">
                                    <div class="input-group">
                                        <i class="fa-solid fa-envelope"></i>
                                        <input type="email" id="login-email" required placeholder="Email..." class="w-full bg-slate-900 rounded-[1.5rem] px-8 py-6 outline-none focus:ring-2 focus:ring-blue-500 font-bold text-white transition-all shadow-inner">
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-[9px] uppercase font-black text-slate-500 ml-4 tracking-[0.3em]">Senha</label>
                                    <div class="input-group">
                                        <i class="fa-solid fa-key"></i>
                                        <input type="password" id="login-password" required placeholder="Sua senha..." class="w-full bg-slate-900 rounded-[1.5rem] px-8 py-6 outline-none focus:ring-2 focus:ring-blue-500 font-bold text-white transition-all shadow-inner">
                                    </div>
                                </div>
                                <button type="submit" class="w-full py-7 btn-primary rounded-[1.5rem] font-black text-xs uppercase tracking-widest text-white shadow-2xl flex items-center justify-center gap-3">
                                    <span>Entrar no Sistema</span> <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                `;
                return;
            }

            app.innerHTML = `
                <div class="h-screen w-full flex overflow-hidden">
                    ${Sidebar()}
                    <main class="flex-1 flex flex-col h-screen overflow-hidden bg-slate-950">
                        <header class="h-24 md:h-32 px-8 md:px-14 flex items-center justify-between border-b border-slate-800/20 bg-slate-950/50 backdrop-blur-3xl z-40">
                            <div class="flex items-center gap-8">
                                <button onclick="setState({isMenuOpen: true})" class="lg:hidden w-14 h-14 glass rounded-2xl flex items-center justify-center text-slate-400 hover:text-white transition-all shadow-sm">
                                    <i class="fa-solid fa-bars-staggered text-xl"></i>
                                </button>
                                <div class="hidden lg:flex flex-col">
                                    <div class="flex items-center gap-3">
                                        <div class="w-2 h-2 bg-accent rounded-full animate-pulse shadow-[0_0_10px_var(--accent)]"></div>
                                        <h2 class="text-[11px] font-black tracking-[0.5em] uppercase text-slate-500">Euro Manager // ${state.view.split('-')[0]}</h2>
                                    </div>
                                    <p class="text-[10px] font-bold text-slate-400 mt-1 flex items-center gap-2">
                                        ${state.isLoading ? `<i class="fa-solid fa-circle-notch animate-spin text-accent"></i> SINCRONIZANDO...` : `<i class="fa-solid fa-wifi text-[8px] text-emerald-500"></i> CONECTADO AO CLOUD`}
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="px-8 py-4 glass rounded-2xl text-[11px] font-black uppercase tracking-[0.3em] text-accent border border-accent/20 shadow-lg flex items-center gap-3">
                                    <i class="fa-solid fa-calendar-alt"></i> ${getTripDateLabel()}
                                </div>
                            </div>
                        </header>
                        <div class="flex-1 overflow-y-auto p-8 md:p-14 lg:p-20 custom-scroll relative">
                            <div class="max-w-7xl mx-auto">
                                ${(Views[state.view] || Views.dashboard)()}
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        window.addEventListener('hashchange', () => {
            const v = window.location.hash.replace('#', '') || 'dashboard';
            window.setState({ view: v });
        });

        const initClasses = ['antialiased', 'overflow-hidden'];
        if (state.theme && state.theme !== 'default') initClasses.push('theme-' + state.theme);
        if (state.mode === 'light') initClasses.push('light-mode');
        document.body.className = initClasses.join(' ');

        if (state.user) fetchData();
        render();
    </script>
</body>

</html>